<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Kids Drawing Website</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f0f8ff; }
    header { background: #4fc3f7; color: #fff; padding: 1em; text-align: center; }
    #toolbar {
      display: flex; flex-wrap: wrap; gap: 10px;
      background: #e1f5fe; padding: 10px; justify-content: center;
    }
    #toolbar > * { margin: 0 5px; }
    #canvas-container { display: flex; justify-content: center; margin: 20px 0; }
    canvas { border: 2px solid #4fc3f7; border-radius: 8px; background: #fff; touch-action: none; }
    #gallery { padding: 1em; }
    .gallery-img { max-width: 150px; max-height: 100px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
    button, select, input[type="color"] { padding: 5px; border-radius: 4px; border: 1px solid #90caf9; }
    @media (max-width: 600px) {
      #canvas-container { flex-direction: column; align-items: center; }
      canvas { width: 95vw !important; height: 60vw !important; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Kids Drawing Website</h1>
    <p>Draw, create, and share your art!</p>
  </header>
  <div id="toolbar">
    <label>Tool:
      <select id="tool">
        <option value="brush">Brush</option>
        <option value="pencil">Pencil</option>
        <option value="eraser">Eraser</option>
        <option value="rectangle">Rectangle</option>
        <option value="circle">Circle</option>
        <option value="line">Line</option>
      </select>
    </label>
    <label>Color: <input type="color" id="color" value="#000000"></label>
    <label>Size: <input type="range" id="size" min="1" max="30" value="5"></label>
    <button id="undo">Undo</button>
    <button id="redo">Redo</button>
    <button id="clear">Clear</button>
    <button id="save">Save</button>
    <button id="download">Download</button>
    <button id="animate">Animate</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawing-canvas" width="800" height="500"></canvas>
  </div>
  <section id="gallery">
    <h2>Gallery</h2>
    <div id="gallery-images"></div>
  </section>
  <script>
    // Canvas setup
    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false, startX = 0, startY = 0;
    let tool = 'brush', color = '#000', size = 5;
    let history = [], redoStack = [];

    function saveState() {
      history.push(canvas.toDataURL());
      if (history.length > 50) history.shift();
      redoStack = [];
      // Store history for animation
      localStorage.setItem('drawingHistory', JSON.stringify(history));
    }

    function restoreState(imgData) {
      let img = new window.Image();
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0);
      };
      img.src = imgData;
    }

    function getPointerPos(e) {
      const rect = canvas.getBoundingClientRect();
      let x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      let y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      return { x, y };
    }

    function drawLine(x1, y1, x2, y2) {
      ctx.strokeStyle = color;
      ctx.lineWidth = size;
      ctx.lineCap = "round";
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();
    }

    function drawShape(x1, y1, x2, y2, shape) {
      ctx.strokeStyle = color;
      ctx.lineWidth = size;
      ctx.beginPath();
      if (shape === 'rectangle') {
        ctx.rect(x1, y1, x2 - x1, y2 - y1);
      } else if (shape === 'circle') {
        let r = Math.hypot(x2 - x1, y2 - y1);
        ctx.arc(x1, y1, r, 0, 2 * Math.PI);
      } else if (shape === 'line') {
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
      }
      ctx.stroke();
    }

    // Drawing events
    let lastX, lastY, snapshot;
    function startDraw(e) {
      drawing = true;
      let pos = getPointerPos(e);
      startX = lastX = pos.x;
      startY = lastY = pos.y;
      if (tool === 'brush' || tool === 'pencil' || tool === 'eraser') {
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
      }
      snapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
      if (tool === 'eraser') ctx.globalCompositeOperation = "destination-out";
      else ctx.globalCompositeOperation = "source-over";
      e.preventDefault();
    }

    function draw(e) {
      if (!drawing) return;
      let pos = getPointerPos(e);
      if (tool === 'brush' || tool === 'pencil') {
        ctx.strokeStyle = color;
        ctx.lineWidth = size;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x; lastY = pos.y;
      } else if (tool === 'eraser') {
        ctx.lineWidth = size * 2;
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x; lastY = pos.y;
      } else if (tool === 'rectangle' || tool === 'circle' || tool === 'line') {
        ctx.putImageData(snapshot, 0, 0);
        drawShape(startX, startY, pos.x, pos.y, tool);
      }
      e.preventDefault();
    }

    function endDraw(e) {
      if (!drawing) return;
      drawing = false;
      if (tool === 'rectangle' || tool === 'circle' || tool === 'line') {
        let pos = getPointerPos(e);
        drawShape(startX, startY, pos.x, pos.y, tool);
      }
      saveState();
      ctx.globalCompositeOperation = "source-over";
      e.preventDefault();
    }

    // Event listeners
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mouseout', endDraw);

    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', endDraw, { passive: false });

    // Toolbar controls
    document.getElementById('tool').onchange = e => tool = e.target.value;
    document.getElementById('color').onchange = e => color = e.target.value;
    document.getElementById('size').oninput = e => size = e.target.value;

    document.getElementById('undo').onclick = () => {
      if (history.length > 1) {
        redoStack.push(history.pop());
        restoreState(history[history.length - 1]);
      }
    };
    document.getElementById('redo').onclick = () => {
      if (redoStack.length) {
        let redoImg = redoStack.pop();
        restoreState(redoImg);
        history.push(redoImg);
      }
    };
    document.getElementById('clear').onclick = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      saveState();
    };
    document.getElementById('save').onclick = () => {
      let imgData = canvas.toDataURL();
      let gallery = document.getElementById('gallery-images');
      let img = document.createElement('img');
      img.src = imgData;
      img.className = 'gallery-img';
      gallery.appendChild(img);
      saveState();
    };
    document.getElementById('download').onclick = () => {
      let link = document.createElement('a');
      link.download = 'drawing.png';
      link.href = canvas.toDataURL();
      link.click();
    };

    // Animate button handler
    document.getElementById('animate').onclick = () => {
      localStorage.setItem('drawingHistory', JSON.stringify(history));
      window.location.href = 'animate.html';
    };

    // Init
    window.onload = () => {
      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      saveState();
    };
  </script>
</body>
</html>
